@model ProductListSideBarVM


<div class="shop-layout__sidebar">
    <div class="block block-sidebar">
        <div class="block-sidebar__item">
            <div class="widget-filters widget" data-collapse
                 data-collapse-opened-class="filter--opened">
                <h4 class="widget__title">Filters</h4>
                <div class="widget-filters__list">

                    <div class="widget-filters__item">
                        <div class="filter filter--opened" data-collapse-item>
                            <button type="button"
                                    class="filter__title" data-collapse-trigger>
                                Categories <svg class="filter__arrow" width="12px" height="7px">
                                    <use xlink:href="/images/sprite.svg#arrow-rounded-down-12x7">
                                    </use>
                                </svg>
                            </button>
                            <div class="filter__body" data-collapse-content>
                                <div class="filter__container">
                                    <div class="filter-categories">
                                        <ul class="filter-categories__list">

                                            <li class="filter-categories__item filter-categories__item--parent">
                                                <svg class="filter-categories__arrow" width="6px"
                                                     height="9px">
                                                    <use xlink:href="/images/sprite.svg#arrow-rounded-left-6x9">
                                                    </use>
                                                </svg> <a asp-controller="ProductFilter" asp-action="ProductListByMegaCategory" asp-route-id="@Model.MegaCategory.Id">@Model.MegaCategory.Name</a>
                                            </li>

                                            @foreach (var item in Model.MegaCategory.Categories)
                                            {
                                                <li class="filter-categories__item filter-categories__item--current">
                                                    <a asp-controller="ProductFilter" asp-action="ProductListByCategory" asp-route-id="@item.Id">@item.Name</a>
                                                </li>
                                                @foreach (var child in item.SubCategories)
                                                {
                                                    <li class="filter-categories__item filter-categories__item--child">
                                                        <a asp-controller="ProductFilter" asp-action="ProductListBySubCategory" asp-route-id="@child.Id">@child.Name</a>
                                                    </li>
                                                }

                                            }
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    @*Price Section*@
                    <div class="widget-filters__item">
                        <div class="filter filter--opened" data-collapse-item>
                            <button type="button"
                                    class="filter__title" data-collapse-trigger>
                                Price <svg class="filter__arrow" width="12px" height="7px">
                                    <use xlink:href="/images/sprite.svg#arrow-rounded-down-12x7">
                                    </use>
                                </svg>
                            </button>
                            <div class="filter__body" data-collapse-content>
                                <div class="filter__container">
                                    <div class="filter-price" data-min="@Model.MinPrice" data-max="@Model.MaxPrice" data-from="@Model.MinPrice" data-to="@Model.MaxPrice">
                                        <div class="filter-price__slider"></div>
                                        <div class="filter-price__title">
                                            Price: $<span class="filter-price__min-value"></span> – $<span class="filter-price__max-value"></span>
                                        </div>
                                       
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    @*Brand Section*@
                    <div class="widget-filters__item">
                        <div class="filter filter--opened" data-collapse-item>
                            <button type="button"
                                    class="filter__title" data-collapse-trigger>
                                Brand <svg class="filter__arrow" width="12px" height="7px">
                                    <use xlink:href="/images/sprite.svg#arrow-rounded-down-12x7">
                                    </use>
                                </svg>
                            </button>
                            <div class="filter__body" data-collapse-content>
                                <div class="filter__container">
                                    <div class="filter-list">
                                        <div class="filter-list__list">

                                            @foreach (var item in Model.Brands)
                                            {
                                                <label class="filter-list__item">
                                                    <span class="filter-list__input  input-check">
                                                        <span class="input-check__body">
                                                            <input class="input-check__input brands" value="@item.Id"
                                                               type="checkbox"> <span class="input-check__box"></span>
                                                            <svg class="input-check__icon" width="9px"
                                                             height="7px">
                                                                <use xlink:href="/images/sprite.svg#check-9x7">
                                                                </use>
                                                            </svg>
                                                        </span>
                                                    </span><span class="filter-list__title">@item.Name </span><span class="filter-list__counter">@item.StockCount</span>
                                                </label>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                     @*Material Section*@
                    <div class="widget-filters__item">
                        <div class="filter filter--opened" data-collapse-item>
                            <button type="button"
                                    class="filter__title" data-collapse-trigger>
                                Material <svg class="filter__arrow" width="12px" height="7px">
                                    <use xlink:href="/images/sprite.svg#arrow-rounded-down-12x7">
                                    </use>
                                </svg>
                            </button>
                            <div class="filter__body" data-collapse-content>
                                <div class="filter__container">
                                    <div class="filter-list">
                                        <div class="filter-list__list">

                                            @foreach (var item in Model.Materials)
                                            {
                                                <label class="filter-list__item">
                                                    <span class="filter-list__input input-check">
                                                        <span class="input-check__body">
                                                            <input class="input-check__input materials"
                                                               type="checkbox" value="@item.Id"> <span class="input-check__box"></span>
                                                            <svg class="input-check__icon" width="9px"
                                                             height="7px">
                                                                <use xlink:href="/images/sprite.svg#check-9x7">
                                                                </use>
                                                            </svg>
                                                        </span>
                                                    </span><span class="filter-list__title">@item.Name </span>
                                                </label>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    @* Color Section*@
                    <div class="widget-filters__item">
                        <div class="filter filter--opened" data-collapse-item>
                            <button type="button"
                                    class="filter__title" data-collapse-trigger>
                                Color <svg class="filter__arrow" width="12px" height="7px">
                                    <use xlink:href="/images/sprite.svg#arrow-rounded-down-12x7">
                                    </use>
                                </svg>
                            </button>
                            <div class="filter__body" data-collapse-content>
                                <div class="filter__container">
                                    <div class="filter-color">
                                        <div class="filter-color__list">
                                            @foreach (var item in Model.Colors)
                                            {
                                                <label class="filter-color__item">
                                                    <span class="filter-color__check input-check-color"
                                                      style="color: @item.Code;">
                                                        <label class="input-check-color__body">
                                                            <input class="input-check-color__input"
                                                               type="checkbox" value="@item.Id"> <span class="input-check-color__box"></span>
                                                            <svg class="input-check-color__icon"
                                                             width="12px" height="9px">
                                                                <use xlink:href="/images/sprite.svg#check-12x9">
                                                                </use>
                                                            </svg> <span class="input-check-color__stick"></span>
                                                        </label>
                                                    </span>
                                                </label>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <form class="widget-filters__actions d-flex">
                    <button type="submit" class="btn btn-primary btn-sm">
                        Filter
                    </button> <button class="btn btn-secondary btn-sm ml-2">
                        Reset
                    </button>
                </form>
                <script>
                $(document).ready(()=>{
                    $(document).on("click",".widget-filters__actions",(e)=>{
                        e.preventDefault();

                        let colors = new Array();
                        $(".input-check-color__input").each(function(e){
                             if( $(this).is(':checked')){
                                 colors.push(new Number($(this).val()))
                             }
                        })

                        let materials = new Array()
                        $(".materials").each(function(e){
                             if( $(this).is(':checked')){
                                 materials.push(new Number($(this).val()))
                             }
                        })
                       
                        let brands = new Array()
                        $(".brands").each(function(e){
                            if( $(this).is(':checked')){
                                 brands.push(new Number($(this).val()))
                             }
                        })

                        let maxPrice =new Number( $(".filter-price__min-value").text());
                        let minPrice = new Number( $(".filter-price__max-value").text());
                        
                        let searchInfo = {
                            ColorIds:colors,
                            MaterialIds:materials,
                            BrandIds:brands,
                            MaxPrice:maxPrice,
                            MinPrice:minPrice
                        } 
                        let searchText =JSON.stringify(searchInfo);
                        location.href = `/ProductFilter/ProductListByFilterInfo/${searchText}`

                    })
                });
                </script>

            </div>
        </div>
        <div class="block-sidebar__item d-none d-lg-block">
            <div class="widget-products widget">
                <h4 class="widget__title">Latest Products</h4>
                <div class="widget-products__list">

                    @foreach (var item in Model.Products)
                    {
                        <div class="widget-products__item">
                            <div class="widget-products__image">
                                <a asp-controller="Home" asp-action="Single" asp-route-id="@item.Id">
                                    <img src="~/images/products/@item.Image" alt="">
                                </a>
                            </div>
                            <div class="widget-products__info">
                                <div class="widget-products__name">
                                    <a asp-controller="Home" asp-action="Single" asp-route-id="@item.Id">
                                        Electric
                                        Planer Brandix KL370090G 300 Watts
                                    </a>
                                </div>
                                <div class="widget-products__prices">
                                    @if (item.OldPrice == null)
                                    {
                                        <span>$@item.CurrentPrice</span>
                                    }
                                    else
                                    {
                                        <span class="product-card__new-price">$@item.CurrentPrice</span> <span class="product-card__old-price">$@item.OldPrice</span>
                                    }
                                </div>
                            </div>
                        </div>
                    }


                </div>
            </div>
        </div>
    </div>
</div>